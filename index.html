<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>SVG World Map Demo</title>
        <link rel="stylesheet" type="text/css" href="https://raphaellepuschitz.github.io/SVG-World-Map/demo/css/demo.css">
        <style>
            body { background-color: #EFEFEF; }
            #svg-world-map-container { opacity: 0; transition: opacity 1s ease-in; }
        </style>
	</head>
	<body>
        <div id="labels" class="box">
            <button onclick="myWorldMap.labels('all')">Country labels</button>
            <button onclick="myWorldMap.labels('micro')">Microstate labels</button>
            <button onclick="myWorldMap.download('svg')">Save as SVG</button>
            <button onclick="myWorldMap.download('png')">Save as PNG</button>
        </div>
        <script src="https://raphaellepuschitz.github.io/SVG-World-Map/src/svg-world-map.js"></script>
        <script>

            // Global variables
            var myWorldMap;

            // Wait for asynchronous JSON load and pass data to library 
            loadConflictData();

            async function loadConflictData() {
                const url = "conflict.json";
                try {
                    const req = await fetch(url);
                    const jsonData = await req.json();
                    //console.log(jsonData);
                    for (var date in jsonData) {
                        for (var country in jsonData[date]) {
                            var value = jsonData[date][country] * 3;
                            var rgb = 'rgb(255,' + (255-value) + ',' + (255-value) + ')';
                            jsonData[date][country] = rgb;
                        }
                    }
                    //console.log(jsonData);
                    // Call the window attached function from the SVG World Map library directly
                    loadSVGWorldMap(jsonData);
                } catch (e) {
                    //console.error(e);
                }
            }

            // Load SVG World Map
            async function loadSVGWorldMap(jsonData) {
                // Custom options
                var options = { 
                    bigMap: true, // Use small map
                    showOcean: false, // Show or hide ocean layer
                    showAntarctica: false, // Show or hide antarctic layer
                    showLabels: true, // Show country labels
                    showInfoBox: true, // Show info box
                    worldColor: '#EFEFEF', 
                    countryStroke: { out: '#CCCCCC',  over: '#666666',  click: '#666666' }, 
                    provinceFill: { out: '#FFFFFF',  over: '#FFFFFF',  click: '#FFFFFF' }, 
                    provinceStroke: { out: '#FFFFFF',  over: '#EEEEEE',  click: '#DDDDDD' }, 
                    timeControls: true, // Time data to activate time antimation controls
                    timePause: false, // Set pause to false for autostart
                    timeLoop: false // Loop time animation
                };
                // Startup SVG World Map
                //myWorldMap = await svgWorldMap(options, false);
                myWorldMap = await svgWorldMap(options, false, jsonData);
                // Fadein with opacity 
                document.getElementById('svg-world-map-container').style.opacity = 1;
            }
            
        </script>
    </body>
</html>
